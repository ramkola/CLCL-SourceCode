CLCL Ver 2.1.1
--

■ はじめに
CLCL(クルクル)は、クリップボードの履歴を取るソフトです。

■ 機能
・複数のクリップボード形式に対応
・よく使う定型文などを階層化して登録可能
・ホットキーで表示するメニューを自由にカスタマイズ
・メニューで選択した履歴や登録アイテムを編集中のエディタに自動貼り付け
・メニューに画像を縮小表示
・メニューにツールチップを表示
・履歴に残す形式や保存する形式を設定可能
・履歴を取るウィンドウ、取らないウィンドウを設定可能
・ウィンドウ毎の貼り付けキーを設定可能
・履歴は終了時に自動保存され、次回起動時に復元
・履歴に残す最大件数の制限は無し
・エクスプローラ風のビューアで履歴や登録アイテムを表示・編集
・プラグインを追加することで機能を拡張
・Unicode対応

■ インストール
Windows XP, Vista, 7, 8, 8.1, 10 で動作します。

ダウンロードしたファイルを起動するとCLCLをインストールします。
アンインストールはコントロールパネルから実施してください。
アンインストールはCLCLを終了してから実施してください。

データは以下のフォルダに保存されます。(Windows 10の場合)
  C:\Users\(ユーザ名)\AppData\Local\CLCL

データをCLCL.exeと同じ場所に保存するには clcl_app.ini を以下にように設定してか
らCLCLを起動してください。

[GENERAL]
portable=1

■ 起動
CLCLを起動するとタスクトレイ(タスクバー隅の時計がある領域)にクリップのアイコン
が表示されます。
このタスクトレイのアイコンをクリックするとメニューが表示されます。
初期設定では、メニューに履歴が昇順に表示されます。
メニューは設定でカスタマイズすることができます。

タスクトレイのアイコンを右クリックするとビューアが表示されます。
ビューアの左は、履歴や登録アイテムを表示するツリーです。
ビューアの右は、履歴や登録アイテムの内容を表示・編集します。編集した内容はフォ
ーカスを移すとアイテムに反映されます。形式によっては編集ができないものもありま
す。現在のクリップボードの内容は編集できません。

ツリーの一番上の「クリップボード」は現在のクリップボードの内容です。
ツリーの「履歴」は履歴の一覧です。
ツリーの「登録アイテム」は登録されているアイテム(定型文など)の一覧です。

	┌─■ クリップボード		- 現在のクリップボードの内容
	│  ├─□ TEXT			- 現在のクリップボードの中の形式
	│  ├─□ LOCALE
	│  └─□ OEM TEXT
	│
	├─■ 履歴			- クリップボードの履歴
	│  ├─□ (BITMAP)		- 履歴アイテム
	│  │  ├─□ BITMAP		- 履歴アイテム内の形式
	│  │  └─□ DIB
	│  │
	│  ├─□ こんにちは...
	│  │  └─□ TEXT
	│  │
	│  ├─□ 今日は...
	│  └─□ (BITMAP)
	│
	└─■ 登録アイテム		- 登録されているアイテム
	    │
	    ├─■ フォルダ		- フォルダ
	    │  ├─□ 住所...
	    │  └─□ (BITMAP)
	    │
	    └─□ http://www...	- 登録アイテム
	        └─□ TEXT		- 登録アイテム内の形式

■ クリップボード
・クリップボードとは？
	クリップボードは、異なるアプリケーション同士で情報をやり取りするための
	領域です。
	例えば、メモ帳でコピーした文字をワードなどに貼り付けることができますが、
	これはクリップボードという領域を利用しているためです。

・クリップボード形式
	クリップボードは一度に複数の形式を入れておくことができます。
	例えば、メモ帳でテキストをコピーした場合、
		・UNICODE TEXT
		・LOCALE
		・TEXT
		・OEM TEXT
	という4つの形式がクリップボードに入ります(Windows 10の場合)
	ExcelやAccessでコピーを行った場合は、更に沢山の形式がクリップボードに
	送られます。

	CLCLの初期設定では、
		・UNICODE TEXT		- テキスト
		・BITMAP		- ビットマップ
		・DROP FILE LIST	- ファイル
	が履歴に残るようになっています。
	オプションの「フィルタ」で、他の形式も履歴に残すことができます。

■ 履歴
クリップボードにコピーしたデータの履歴です。
新しくコピーしたデータは履歴の一番上に追加されます。

一つの履歴アイテムの中には複数のクリップボード形式が入っています。オプションの
「形式」で登録されているもので、優先順位の高いクリップボード形式がメニューや
ビューアで表示されます。

履歴の件数はオプションの「履歴」で設定した分だけ残ります。
クリップボード形式はオプションの「フィルタ」で追加に設定してあるものだけが履歴
に追加されます。

■ 登録アイテム
登録アイテムには、定型文などよく使うデータを登録しておくことができます。
フォルダを追加して階層化したり、アイテムに名前を付けることができます。

登録アイテムを追加するには、ビューアを開いて履歴のアイテムを選択し、メニューか
ら「登録アイテムに追加」を選択します。
ツリーで追加したいフォルダを選択し、メニューから「新規作成」を選択すると空のア
イテムやファイルから内容を読み込んでアイテムを作成することができます。

フォルダを追加するには、ビューアを開いて登録アイテム内の追加したい場所で右クリッ
クメニューを出し「フォルダの作成」を選択します。

フォルダやアイテムの名前を変更するには、ビューアを開いて変更したいアイテムを選
択して右クリックメニューを出し「名前の変更」を選択します。
「名前の初期化」は設定した名前を消して、アイテムの内容を名前として表示するよう
にします。
アイテムの名前を「-」にするとメニューで区切りとして表示します。アイテム内の形
式やデータは無視します。
名前に & をつけるとその次の文字をメニューでのショートカットキーとします。& そ
のものをメニューに表示する場合は && としてください。

登録アイテムを右クリックしてメニューを出し「ホットキー設定」を選択すると、登録
アイテムにホットキーを割り当てることができます。そのキーを押すとメニューを表示
せずに直接登録アイテムをクリップボードに送って、「貼り付け」を有効にしている場
合は直接貼り付けます。
登録してあるホットキーは、ビューアで一覧表示の部分で確認できます。その他登録ア
イテムを選択するとステータスバーに表示されます。

登録アイテムの件数やクリップボード形式に制限はありません。

■ クリップボードに送る
履歴や登録アイテムをクリップボードに送るにはいくつかの方法があります。
・タスクトレイをクリックしてメニューを出します。
  その中から履歴や登録アイテムの項目を選択すると、データをクリップボードに送っ
  て、自動的にアクティブなウィンドウに貼り付けます。

・ホットキー(初期状態では Alt + C)を押してメニューを出します。
  その中から履歴や登録アイテムの項目を選択すると、データをクリップボードに送っ
  て、自動的にアクティブなウィンドウに貼り付けます。

・ビューアでアイテムを選択し、右クリックメニューを出します。
  「クリップボードに送る」を選択すると選択中のアイテムをクリップボードに送りま
  す。

■ メニュー
タスクトレイやホットキーで表示するメニューの項目はオプションの「動作」で設定し
ます。
メニューの動きや表示のカスタマイズはオプションの「メニュー」で設定します。

メニューの履歴や登録アイテムの項目の上にマウスを持っていくと、マウスの位置に詳
細な内容をツールチップで表示されます。キーボードで項目を選択した場合は、メニュー
項目の下にツールチップが表示されます。

メニューの履歴や登録アイテムの項目の上で右クリックすると登録されているツールを
メニュー表示し、アイテムに選択したツールを実行してクリップボードに送ります。
キーボードでツールメニューを出すには、Ctrl を押しながら Enter で項目を選択しま
す。

履歴と登録アイテムはオプションの「メニューテキストの表示形式」に従ってメニュー
項目を表示します。表示される数字は、0 から始まりますが、開始の値を変更する場合
は % と文字の間に開始番号を設定してください。
    例)
         %0d -> 0,1,2,3...
         %8x -> 8,9,a,b...
         %1n -> 1,2,3...8,9,0,1,2...
         %10B -> K,L,M,N...

■ 動作
ホットキーを押したときの動作や、タスクトレイのアイコンをクリックしたときの動作
は、オプションの「動作」で設定します。

動作の編集の、動作で「メニュー」を指定した場合は、画面下部のメニューの設定で、
表示するメニュー項目を設定します。

呼び出し方法は、指定した動作を呼び出す方法を設定します。
「ホットキー」を指定した場合は、呼び出すキーを設定します。
「Ctrl + Ctrl」、「Shift + Shift」、「Alt + Alt」はキーを２回押した時に指定し
た動作を呼び出します。

動作にメニューを指定すると「貼り付け」を設定できます。
「貼り付け」は、メニューで項目を選択すると作業中のアプリに自動的に貼り付けの動
作が送られます。
メニューの項目を選択するときに Shift を押しながら選択すると貼り付けをしないで
クリップボードに送るのみになります。

動作にメニューを指定して、呼び出し方法にホットキー、Ctrl + Ctrl、Shift + Shift、
Alt + Alt のいずれかを指定した場合は「キャレット位置に表示」を設定できます。
「キャレット位置に表示」は、メニューがエディタのキャレットの位置に表示されます。
設定しない場合はマウスの位置にメニューが表示されます。

動作にメニューを指定して、項目に履歴を選択すると表示範囲を設定することができま
す。表示範囲は、1 から履歴に残す件数までを指定します。開始番号に 0 を指定した
場合は、1 を指定したことと同じ意味になり、終了番号に 0 を指定した場合は、履歴
に残す件数を指定したのと同じ意味になります。
終了番号が開始番号より小さい場合は何も表示しません。終了番号が履歴に残す件数よ
り大きい場合は、履歴に残す件数までの表示になります。

■ クリップボード形式
CLCLはすべてのクリップボード形式を処理することができますが、登録されていない
クリップボード形式は、ビューアではバイナリのダンプで表示されます。

クリップボード形式はオプションの「形式」で登録します。上に登録してあるものが
優先され、メニューやビューアではアイテムの中の優先順位の高いクリップボード形
式が表示されます。

登録は、形式名と処理するDLLと関数ヘッダを設定します。DLLを省略して関数ヘッダの
選択ボタンを押すと内蔵の関数ヘッダ一覧が表示されます。
例えば、エクセルでコピーしたときのクリップボード形式のうち CSV をテキストとし
て処理したい場合は、
	形式名: CSV
	DLL:
	関数ヘッダ: text_
と設定するとメニューとビューアでテキストとして処理されるようになります。

■ フィルタ
履歴に追加するクリップボード形式を選択するにはオプションの「フィルタ」で設定し
ます。

「すべての形式を履歴に追加」を選択すると除外に設定しているクリップボード形式以
外が履歴に追加されます。
「すべての形式を履歴から除外」を選択すると追加に設定しているクリップボード形式
のみが履歴に追加されます。

フィルタで追加に設定したクリップボード形式は、更に履歴に追加するときの制限サイ
ズを設定することができます。制限サイズを超えるデータは履歴に追加しないようにし
ます。

フィルタで追加に設定したクリップボード形式で、「保存しない」を設定するとCLCL終
了時にファイルに保存されないようになります。
例えばテキストとビットマップを履歴に追加してテキストのみを保存するという設定が
できます。

■ ウィンドウ設定
使用するアプリケーションによってCLCLの動きを変える場合は、オプションの「ウィン
ドウ」でウィンドウと動作を設定します。

ウィンドウのタイトルとクラス名を指定し、"*"を任意の文字として使えます。
例えばメモ帳の場合、
	タイトル: * - メモ帳
	クラス名: Notepad
と設定するとメモ帳がアクティブな時のCLCLの動作が変わります。
タイトルとクラス名はどちらかが入力されていればよく、未入力の場合は "*" のみを
指定したのと同じ意味になります。

・履歴に追加しない
	設定したウィンドウでコピー操作しても履歴に追加されないようになります。
	履歴に入れることで不具合が生じるアプリケーションはこのオプションを指定
	しておくとそのアプリケーションからのコピーは無視されるようになります。

・フォーカスを設定しない
	設定したウィンドウでアクティブにした後のフォーカス設定がされないように
	なります。
	選択したメニュー項目を貼り付けるときにフォーカスがどこかに行ってしまい
	正常に貼り付けができない場合にこのオプションを指定すると正常に動作する
	場合があります。

・ツールをキャンセルしても貼り付けをする
	キャンセル可能なツールでキャンセルの操作をしたときに通常その後の貼り付
	けはしませんが、このオプションを指定するとキャンセルしても貼り付けされ
	るようになります。
	ウィンドウ毎のキー設定でコピーキーを切り取りのキーに設定した場合に、こ
	のオプションを指定しておくとツールをキャンセルしても文字が消えることが
	無くなります。

■ ウィンドウ毎のキー設定
ホットキーから履歴や登録アイテムを選択し、自動的に貼り付けの動作は、ウィンドウ
に貼り付けのキーを送っています。
初期設定ではすべてのウィンドウに Ctrl + V を送っていますが、ウィンドウによって
は貼り付けのキーが他のキーになっている場合があります。

ホットキーでツールを呼び出した時は、コピー -> ツール処理 -> 貼り付け の動作を
するため、ウィンドウにコピーのキー(Ctrl + C)を送っています。

ウィンドウ毎のコピーと貼り付けのキーは、オプションの「キー」で設定します。
設定するウィンドウのタイトルとクラス名を設定し、コピーと貼り付けのキーを設定し
ます。

コピーと貼り付けのキーは、設定していないとデフォルトのキー設定が使われます。

一つのウィンドウに複数のキーを設定できます。複数設定した場合は上にある設定から
順にキーが送られます。

■ ツール (プラグイン)
履歴や登録アイテムのデータを加工したり、CLCLの機能を拡張するには、オプション
の「ツール」で設定します。

DLLと関数名を選択するとツール名と実行のタイミングが自動的に設定されます。
実行のタイミングの「動作メニュー」は、オプションの動作で設定したメニューから実
行できるようにします。
実行のタイミングの「ビューア」は、ビューアのツールメニューから実行できるように
します。

実行のタイミングの「コピーと貼り付けを送る」は、アクティブなウィンドウにコピー
を送り、コピーされたデータにツールを実行し、その実行結果がアクティブなウィンド
ウに貼り付けられます。
このオプションをチェックしない場合は、一番新しい履歴アイテムにツールを実行して
クリップボードに送ります。動作メニューでアイテムを右クリックした時に出るツール
メニューでは選択したアイテムにツールを実行してクリップボードに送られます。
動作の設定で「貼り付け」が有効になっていない場合は、コピーしてツールを実行した
後に貼り付けをしません。

ツール一覧のウィンドウにDLLをドラッグ＆ドロップすると登録可能なツール一覧を表
示し、複数選択して一括でツールを登録することができます。

■ コマンドライン
CLCL起動時にコマンドラインを指定して起動後の動作を指定することができます。
既にCLCLが起動している場合は、既に起動しているCLCLにコマンドが送られます。

[形式]
CLCL.exe [/vownx]
	/v ビューア表示
	/w クリップボード監視
	/n クリップボード監視解除
	/x 終了

■ Special thanks
K.Takata ( http://webs.to/ken/ )

■ 更新履歴
・Ver 2.1.0 -> Ver 2.1.1
	・ファイル形式でファイル名とファイルパスのコピー機能を追加した。
	・設定やデータをCLCL.exeと同じ場所に置ける設定を追加した。

・Ver 2.0.3 -> Ver 2.1.0
	・高DPIに対応した。
	・画像形式(BITMAP, DIB)のファイル保存でPNGとJPEGに対応した。
	・画像形式(BITMAP, DIB)の表示で拡大・縮小できるようにした。
	　→Ctrlを押しながらマウスホイールするか、Ctrl+↑↓で拡大率を変更。
	・バイナリを日本語版と英語版で分けないようにした。
	・設定保存場所をユーザ毎の領域に保存するように変更した。
	  →Windows 10の場合「C:\Users\(ユーザ名)\AppData\Local\CLCL」
	　　※初回起動時に自動的に移行します

・Ver 2.0.2 -> Ver 2.0.3
	・英語版設定画面の誤字を修正した。

・Ver 2.0.1 -> Ver 2.0.2
	・設定ファイルをUnicode対応した。
	  →一度Ver 2.0.2で起動すると設定ファイルがUnicodeになります。
	    変換前のファイルは「general.ini.back」と「clcl.ini.back」という
	    ファイル名でバックアップされます。
	    古いバージョンに戻す場合は上記ファイルを利用してください。
	・起動関数をWinMainからwWinMainに変更した。

・Ver 2.0.0 -> Ver 2.0.1
	・K.Takataさんからの修正コードを取り込み
	  →Unicodeのサロゲートペア対応
	  →タスクトレイの追加に失敗した場合のリトライ処理
	  →連続した二重起動時抑制と別ユーザからの二重起動の抑制
	・設定の「動作」で無効にしているアイテムの色が見えなくなる場合があった
	  のを修正した。
	・クリップボード監視を停止している際のタスクトレイアイコンを改善した。

・Ver 1.1.2 -> Ver 2.0.0
	・Unicode対応した。それに伴い古いWindowsを動作対象から外しています。
	  →旧バージョンの設定を引き継ぎますがツールや形式のプラグインは
	    Unicode対応版を利用する必要があります。
	・CLCL終了時の保存処理で失敗した場合に登録アイテムなどが消えないように
	  保存に成功した場合にファイルコピーする動作に変更した。
	・タスクトレイのアイコンデザイン変更した。
	・タスクトレイをクリックした際のデフォルト動作を変更した。
	  →タブレットでの動作を考慮してタスクトレイのアイコンを左クリックで
	    メニューが出るように変更しました。

・Ver 1.1.1 -> Ver 1.1.2
	・256色の環境で、ツールチップの背景が正しく表示されないのを修正した。
	・メニュー表示方法を最適化した。
	・ビューアのテキスト表示を最適化した。

・Ver 1.1.0 -> Ver 1.1.1
	・TEXT編集でマウスで文字位置を選択したときの動作を改善した。
	・終了時にフィルタで保存する履歴が1件も無い場合にエラーが出るのを修
	  正した。
	・履歴と登録アイテム間でアイテムの移動を可能にした。
	・画像の縮小表示の方法を変更した。
	・コピーと貼り付けの待ち時間の初期値を 100 に変更した。
	・メモリの解放漏れしている箇所があったのを修正した。

・Ver 1.0.9 -> Ver 1.1.0
	・メニューを出すホットキーにCtrl+Vなどを指定した場合にメニューがルー
	  プしてしまうのを修正した。
	・動作やツールのホットキーでWindowsキーやSpaceキーを指定できるように
	  した。

・Ver 1.0.8 -> Ver 1.0.9
	・ビューアで新規作成時に同一形式の確認メッセージをキャンセルすると表
	  示が乱れてしまうのを改善した。
	・ビューアで形式の内容を編集すると優先順位とは関係なく無条件に編集し
	  た形式が表示されるのを修正した。
	・ビューアでアイテムを編集したときにステータスバーが更新されていなか
	  ったのを修正した。
	・TEXT編集で日本語入力位置がずれる場合があったのを修正した。

・Ver 1.0.7 -> Ver 1.0.8
	・INIファイル名の変更 (user.ini -> clcl.ini)
	  起動時に自動的にファイル名を変更します。
	・TEXT形式の表示・編集をリッチエディットコントロールから自前のものに
	  変更した。
	・ビューアからツールを呼び出した時のビューア側の動作を改善した。
	・バイナリ表示の機能を拡張した。
	・その他

・Ver 1.0.6 -> Ver 1.0.7
	・メニューでShiftキーを押しながら項目を選択すると貼り付けをしないでク
	  リップボードに送るだけにした。
	・コマンドラインオプションを追加した。
	・一部のウィンドウにキーが送れていなかったのを修正した。
	・オプションのビューアでリストのデフォルト動作の設定を増やした。

・Ver 1.0.5 -> Ver 1.0.6
	・動作の設定で、項目をコピーできるようにした。
	・動作の設定で、履歴の表示件数を表示範囲に変更した。
	・オプション画面を微調整した。

・Ver 1.0.4 -> Ver 1.0.5
	・登録アイテムにホットキーを割り当て可能にした。
	・メニューにホットキーを表示するようにした。
	・起動時にビューアの位置を補正しないようにした。
	・ビューアを閉じる時に位置とサイズを強制保存するようにした。
	・バイナリ表示時のキャラクタ表示部でで0x7Fを表示しないようにした。
	・ファイルがロックされていても開けるようにした。

・Ver 1.0.3 -> Ver 1.0.4
	・動作の設定画面にファイルをD&Dすると外部アプリケーションとして自動登
	  録できるようにした。

・Ver 1.0.2 -> Ver 1.0.3
	・WindowsXPでOS終了時に履歴が正常に保存できていなかったのを修正した。

・Ver 1.0.1 -> Ver 1.0.2
	・メニューに関連付けられたメモリの解放のタイミングを改善した。
	・フォルダアイコンはシステムのアイコンを使うようにした。

・Ver 1.0.0 -> Ver 1.0.1
	・ウィンドウ毎の設定項目を追加した。
	・環境によってテキストのフォント変更後再描画されないのを修正した。
	・一部のソフトで貼り付けができない場合があるのを修正した。
	・ウィンドウ設定とキー設定でウィンドウ名とクラス名の片方のみの指定にす
	  ると全ウィンドウが対象になってしまうのを修正した。

・Ver 0.2.0 -> Ver 1.0.0
	・作り直し

	  データや設定は引き継ぎません。

	  Ver 0.2.0 の登録アイテムを Ver 1.0.0 に移行したい場合は、両方起動して
	  Ver 0.2.0 の登録アイテムをクリップボードに送り Ver 1.0.0 の履歴に追
	  加します。
	  そして Ver 1.0.0 に追加された履歴から Ver 1.0.0 の登録アイテムに登録
	  してください。

	  ツールは Ver 0.2.0 に対応したツールを Ver 1.0.0 でも使用することがで
	  きます。(一部制限あり)

--

このプログラムによって起きたいかなる障害も作者は責任を持ちません。
大切なファイルはバックアップをとっておくことを強く薦めます。

バグ、要望、質問は nakka@nakka.com までお願いします。

Copyright (C) 1996-2019 by Ohno Tomoaki. All rights reserved.
	https://www.nakka.com/

2019/12/17
